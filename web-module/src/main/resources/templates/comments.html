<!DOCTYPE HTML>
<html xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Comments</title>
</head>
<body>
<header>
    <span sec:authorize="isAuthenticated()">
        Logged user : <span sec:authentication="name"></span>   |
        Role: <span sec:authentication="principal.authorities"></span>   |
        <a th:href="@{/items}">Items</a>|
        <a th:href="@{/orders}">Orders</a>   |
        <a th:href="@{/articles}">Articles</a>   |
        <span sec:authorize="hasAuthority('CUSTOMER USER')"><a th:href="@{/profile}">Profile</a>|</span>
        <span sec:authorize="hasAuthority('CUSTOMER USER')"><a th:href="@{/reviews/new}">Reviews</a>|</span>
        <a th:href="@{/logout}">Logout</a>
    </span>
</header>
<th:block th:object="${article}">
    <h1 th:text="${article.name}">...</h1>
    <h3 th:text="'Author: '+${article.userDTO.name}+' '+${article.userDTO.surname}">...</h3>
    <h3 th:text="'Created: '+${article.created}+' Views: '+${article.views}">...</h3>
    <p th:text="${article.text}">...</p>
    <hr/>
    <div sec:authorize="hasAuthority('SALE USER')">
        <form method="post" th:action="@{/articles/{article_id}/change(article_id=${article.id})}"
              th:object="${articleDTO}">
            <table>
                <tr>
                    <td>Name:</td>
                    <td><input maxlength="100" placeholder="Article New Name" required th:field="*{name}" type="text"/>
                    </td>
                    <td th:errors="*{name}" th:if="${#fields.hasErrors('name')}">Name Error</td>
                </tr>
                <tr>
                    <td>Text:</td>
                    <td>
                <textarea cols="50" maxlength="1000" placeholder="Type new article text here" required rows="10"
                          th:field="*{text}"></textarea>
                    </td>
                    <td th:errors="*{text}" th:if="${#fields.hasErrors('text')}">Text Error</td>
                </tr>
                <tr>
                    <td></td>
                    <td>
                        <button type="submit">Change Article Info</button>
                    </td>
                </tr>
            </table>
            <hr/>
        </form>
    </div>
    <h3>Comments:</h3>
    <div sec:authorize="hasAuthority('CUSTOMER USER')">
        <form method="post" th:action="@{/articles/{article_id}/comments/new(article_id=${article.id})}"
              th:object="${commentDTO}">
        <textarea cols="40" maxlength="200" placeholder="Your comment" required rows="5"
                  th:field="${commentDTO.text}"></textarea><br/>
            <span th:errors="${commentDTO.text}" th:if="${#fields.hasErrors('text')}">Text Error</span><br/>
            <input type="submit" value="Create comment"/>
            <hr/>
        </form>
    </div>
</th:block>
<th:block th:each="comment : ${article.comments}">
    <h5 th:text="'Author: '+${comment.userDTO.name}+' '+${comment.userDTO.surname}">...</h5>
    <h5 th:text="'Created: '+${comment.created}">...</h5>
    <p th:text="${comment.text}">...</p>
    <div sec:authorize="hasAuthority('SALE USER')">
        <form method="post" th:action="@{/articles/{article_id}/comments/delete(article_id=${article.id})}">
            <input hidden name="comment_id" th:value="${comment.id}">
            <input type="submit" value="Delete Article">
        </form>
    </div>
    <hr/>
</th:block>
</body>
</html>

